<% include header.ejs %>
	<div id="StockData">
		<div class="head">入力</div>
		<form action="/users/insert" method="post" accept-charset="utf-8">
			証券コード <input type="text" id="TickerSymbol" name="証券コード" value="" placeholder="証券コード" required>
			社名 <input type="text" id="company" name="会社名" value="" placeholder="google">
			決算期 <select name="決算期" id="settlement">
				<option value="2015">2015</option>
				<option value="2014">2014</option>
				<option value="2013">2013</option>
				<option value="2012">2012</option>
				<option value="2011">2011</option>
			</select><br>
			流動資産 <input type="text" id="current_assets" class="bs" name="流動資産" value="200"><!-- 流動資産 -->
			固定資産 <input type="text" id="permanent_assets" class="bs" name="固定資産" value="300"><!-- 固定資産 -->
			流動負債 <input type="text" id="current_liabilities" class="bs" name="流動負債" value="250"><!-- 流動負債 -->
			固定負債 <input type="text" id="fixed_liabilities" class="bs" name="固定負債" value="100"><!-- 固定負債 -->
			純資産 <input type="text" id="net_assets" class="bs" name="純資産" value="150"><br><!--  純資産 -->
			売上高 <input type="text" id="sales" class="pl" name="売上高" value="500"><!-- 売上高 -->
			営業利益 <input type="text" id="Operating_Profit" class="pl" name="営業利益" value="200"><!-- 営業利益 -->
			経常利益 <input type="text" id="Ordinary_Profit" class="pl" name="経常利益" value="150"><!-- 経常利益 -->
			当期純利益 <input type="text" id="Net_income" class="pl" name="当期純利益" value="50"><!-- 当期純利益 -->
			<input type="submit" name="送信" value="アップロード">
		</form>
		<div class="head">データ解析</div>
		<form action="/users/graph2" method="post" accept-charset="utf-8">
			証券コード<input type="text" name="ticker" value="" placeholder="証券コード">
			項目 <select name="item" id="item">
				<option value="流動資産">流動資産</option>
				<option value="固定資産">固定資産</option>
				<option value="流動負債">流動負債</option>
				<option value="固定負債">固定負債</option>
				<option value="純資産">純資産</option>
				<option value="売上高">売上高</option>
				<option value="営業利益">営業利益</option>
				<option value="経常利益">経常利益</option>
				<option value="当期純利益">当期純利益</option>
			</select>
			<input type="submit" name="graph" value="ビジュアライズ">
		</form>
	</div>
	<div>サーバー処理</div>
	<div id="graph"><%- graph %></div>
	<div>クライアント処理</div>
	<div id="svg"></div>
	<div id="refarence">
		<a href="http://ja.d3js.info/mike/selection/" target="_blank">D3 データバインドの正体</a>
	</div>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
	<script type="text/javascript">
	$(function() {
		$('#graph').on({
			'mousedown': function(e) {
				this.initX = parseInt($(this).css('margin-left'));
				this.startX = e.pageX;
				this.initY = parseInt($(this).css('margin-top'));
				this.startY = e.pageY;

				$(this).on('mousemove', function(e) {
					this.moveX = this.startX -e.pageX;
					this.currentX = this.initX - this.moveX;
					this.moveY = this.startY -e.pageY;
					this.currentY = this.initY - this.moveY;
					$(this).css({'margin-left': this.currentX, 'margin-top': this.currentY});
				});
			},
			'mouseup': function(e) {
				$(this).off('mousemove');
				$(this).css({'margin-left': this.currentX, 'margin-top': this.currentY});
			},
			'mouseenter': function(e) {
				$(this).css({cursor: 'move'});
				console.log('enter' + e.pageX);
				$(this).on('mousedown', function(){
					$(this).css({cursor: 'move'});
				});
			}
		});
		$('#svg').on('click', function(e) {
			console.log(e.target);
		});

		var dataSet = [200,450,500,570];
		var dataSetYear = [2014,2013,2012];

		var svg = d3.select("#svg")
			.append('svg')
			.attr({
				x: 0,
				y: 0,
				width: 100 + '%',
				height: dataSet.length * 30 + 90
			})

		svg.selectAll('rect')
			.data(dataSet)
			.enter()
			.append('rect')
			.attr({
				x: 20,
				y:function(d, i) { 
					return 20 + i*30;
				},
				height: 20,
				width: 0,
				fill: "rgba(0,0,0,.16)"
			})
			.transition()
			.duration(300)
			.attr({
				width: function(d ,i) {
					return d;
				}
			})

		svg.selectAll('text')
			.data(dataSet)
			.enter()
			.append('text')
			.attr({
				'font-size': '.8em',
				x: function(d, i) {
					return 24 + d;
				},
				y: function(d, i) {
					return 35 + i * 30;
				},
				fill: 'gray'
			})
			.text(function(d, i) {
				return d;
			})

		svg.selectAll('text2')
			.data(dataSetYear)
			.enter()
			.append('text')
			.attr({
				'font-size': '.56em',
				x: 24,
				y: function(d, i) {
					return 35 + i * 30;
				},
				fill: 'black'
			})
			.text(function(d, i) {
				return d;
			})

		var Xscale = d3.scale.linear()
			.domain([0, Math.max.apply(null, dataSet)])
			.range([0, Math.max.apply(null, dataSet)])

		svg.append('g')
			.attr({
					x: 0,
					y: 0
			})
			.attr({transform: 'translate(20,150)'})
			.attr({'class': 'axis'})
			.call(d3.svg.axis()
			.scale(Xscale)
			.orient('top')
			)

	});
	</script>
</body>
</html>


